@if (guild) {
  <button (click)="goBack()" class="text-gray-600 hover:text-gray-800">
    <mat-icon>arrow_back</mat-icon>
  </button>
}

@if (guild || currentGuild$(); as guild) {
  <div class="p-4 flex flex-col gap-4">

    <mat-card class="shadow-lg rounded-lg">
      <app-guild-header
        (sendAllianceRequest)="sendAllianceRequest($event)"
        (showMembershipRequests)="onOpenPendingMembershipRequests()"
        [currentUser]="currentUser$()!"
        [guild]="guild"
        [hidden]="loading"
        [pendingMembershipRequestsCount]="pendingMembershipRequestsCount$()"
      />

      <app-guild-members-table
        (memberRemoved)="removeMember($event)"
        (roleUpdated)="updateRole($event)"
        *ngIf="guild.members"
        [currentUser]="currentUser$()!"
        [guildId]="guild.id!"
        [hidden]="loading"
        [members]="guild.members"
      />

      <div *ngIf="loading" class="custom-shadow">
        <mat-spinner class="mx-auto min-h-[11.75rem]" color="accent" diameter="50"></mat-spinner>
      </div>
    </mat-card>

    <div *ngIf="!loading && guild.allies" class="flex flex-col gap-3">
      <div class="flex justify-between">
        <div class="text-2xl font-bold">Alliances <span>{{ guild.allies.length }}/3</span></div>

        <div class="flex items-center gap-3">
          <button
            (click)="onOpenPendingAllianceRequests()"
            *ngIf="hasRequiredRole(currentUser$()?.role!, UserRoleEnum.OFFICER) && currentUser$()?.guild!.id === guild.id"
            [matBadgeHidden]="pendingAllianceRequestsCount$() === 0"
            [matBadge]="pendingAllianceRequestsCount$()"
            color="accent"
            mat-raised-button
            matBadgeColor="warn">
            Demandes d'alliance
          </button>
          <button
            (click)="onOpenGuildSelection()"
            *ngIf="hasRequiredRole(currentUser$()?.role!, UserRoleEnum.LEADER) && currentUser$()?.guild!.id === guild.id"
            [disabled]="guild.allies.length > 2"
            [matBadge]="guildsForAlliance$().length"
            color="primary"
            mat-raised-button
            matBadgeColor="primary">
            Trouver une alliance
          </button>
        </div>
      </div>

      <div *ngIf="!loading" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <app-alliance-card *ngFor="let ally of guild.allies" [guild]="ally"/>
      </div>
    </div>
  </div>
}
